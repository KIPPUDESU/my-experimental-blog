import{d as R,m as D,i as m,n as C,p as E,c as n,g as t,t as s,k as l,b as i,F as T,r as F,w as u,l as _,o,e as H,E as w,a as U,_ as j}from"./index-D-8WlOe0.js";import{u as q}from"./useArticleStore-Bd_87v6D.js";import{u as z}from"./useCommentStore-BU5xzKRj.js";const G={key:0},J=["innerHTML"],K={class:"comments-section"},O={key:0},P={class:"comment-header"},Q={class:"author"},W={class:"time"},X={class:"comment-content"},Y={key:1,class:"no-comments"},Z={key:2,class:"add-comment"},$={key:3,class:"login-prompt"},ee={key:1},te=R({__name:"ArticleDetail",setup(oe){const b=D(),v=U(),x=q(),f=z(),p=Number(b.params.id),a=m(x.getById(p)||null),d=m([]);function g(){d.value=f.listByArticle(p)}const r=m({content:""}),S=m(),h=C(()=>!!localStorage.getItem("username")),A=C(()=>localStorage.getItem("username")||"匿名");E(()=>{a.value&&g()});function B(){v.push("/login")}function I(){if(!h.value){w.warning("请先登录再发表评论"),v.push("/login");return}if(!r.value.content.trim()){w.warning("评论内容不能为空");return}f.add(p,A.value,r.value.content),r.value.content="",g()}return(ne,e)=>{const V=i("el-divider"),L=i("el-card"),M=i("el-input"),y=i("el-form-item"),k=i("el-button"),N=i("el-form");return a.value?(o(),n("div",G,[t("h2",null,s(a.value.title),1),t("p",null,"分类："+s(a.value.category)+" | 时间："+s(a.value.createdAt.slice(0,10)),1),t("div",{innerHTML:a.value.content,class:"content"},null,8,J),t("section",K,[t("h3",null,"评论 ("+s(d.value.length)+")",1),l(V),d.value.length?(o(),n("div",O,[(o(!0),n(T,null,F(d.value,c=>(o(),H(L,{key:c.id,class:"comment-card",shadow:"never"},{default:u(()=>[t("div",P,[t("span",Q,s(c.author),1),t("span",W,s(c.createdAt.slice(0,10)),1)]),t("div",X,s(c.content),1)]),_:2},1024))),128))])):(o(),n("div",Y,"暂无评论，快来抢沙发！")),h.value?(o(),n("div",Z,[l(N,{model:r.value,ref_key:"formRef",ref:S,"label-width":"0"},{default:u(()=>[l(y,{prop:"content"},{default:u(()=>[l(M,{type:"textarea",modelValue:r.value.content,"onUpdate:modelValue":e[0]||(e[0]=c=>r.value.content=c),placeholder:"写下你的评论...",rows:"3"},null,8,["modelValue"])]),_:1}),l(y,null,{default:u(()=>[l(k,{type:"primary",onClick:I},{default:u(()=>e[1]||(e[1]=[_("发表评论")])),_:1})]),_:1})]),_:1},8,["model"])])):(o(),n("div",$,[e[3]||(e[3]=_(" 请先 ")),l(k,{type:"text",onClick:B},{default:u(()=>e[2]||(e[2]=[_("登录")])),_:1}),e[4]||(e[4]=_(" 后发表评论 "))]))])])):(o(),n("div",ee,"文章不存在或已删除"))}}}),re=j(te,[["__scopeId","data-v-67bbc983"]]);export{re as default};
